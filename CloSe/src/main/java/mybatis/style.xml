<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace = "style.StyleBean">
	<insert id="insertStyle">
		insert into style values
		(style_seq.nextval, #{image1}, #{image2, jdbcType=VARCHAR}, #{image3, jdbcType=VARCHAR}, #{image4, jdbcType=VARCHAR}, #{image5, jdbcType=VARCHAR}, #{title, jdbcType=VARCHAR}, #{content}, #{style}, 0, 0, sysdate, #{product_number1, jdbcType=VARCHAR}, #{product_number2, jdbcType=VARCHAR}, #{product_number3, jdbcType=VARCHAR}, #{product_number4, jdbcType=VARCHAR}, #{member_id})
	</insert>
	
	<select id="getStyleList" resultType="StyleBean">
		 select s.*, nickname
	    from style s
	    left join
	      member m ON s.member_id = m.member_id
	</select>
	
	<select id="getStyleByStyleNumber" resultType="StyleBean">
		SELECT
		    s.*,
		    m.nickname AS nickname,
		    p1.product_name AS product_name1,
		    p1.price AS price1,
		    p1.image AS pimage1,
		    p2.product_name AS product_name2,
		    p2.price AS price2,
		    p2.image AS pimage2,
		    p3.product_name AS product_name3,
		    p3.price AS price3,
		    p3.image AS pimage3,
		    p4.product_name AS product_name4,
		    p4.price AS price4,
		    p4.image AS pimage4
		FROM
		    style s
		LEFT JOIN
		    product p1 ON s.product_number1 = p1.product_number
		LEFT JOIN
		    product p2 ON s.product_number2 = p2.product_number
		LEFT JOIN
		    product p3 ON s.product_number3 = p3.product_number
		LEFT JOIN
		    product p4 ON s.product_number4 = p4.product_number
		LEFT JOIN
		    member m ON s.member_id = m.member_id
		WHERE
		    s.style_number = #{style_number}
	</select>
	
	<select id="getTemperatureAvgByStyle" resultType="StyleBean">
		select style_number, avg(temperature) avg_temperature from
		style join product
		on product_number1 = product_number
		or product_number2 = product_number
		or product_number3 = product_number
		or product_number4 = product_number
		group by style_number
	</select>
	
	<update id="updateReadCount">
		update style set read_count = read_count + 1
		where style_number = #{style_number}
	</update>
	
	<delete id="deleteByStyleNumber">
		delete style
		where style_number = #{style_number}
	</delete>
</mapper>