<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace = "product.ProductBean">
	<select id="getAllProduct" resultType="ProductBean">
		select * from product
	</select>
	<insert id="insertProduct">
		insert into product values
		(product_seq.nextval,#{product_name},#{image},#{price},#{content},#{temperature},#{s_stock},#{m_stock},#{l_stock},#{xl_stock},#{smallcategory_name})
	</insert>
	<select id="getOneProduct" resultType="ProductBean">
		select * from product where product_number = #{product_number}
	</select>
	<select id="getProductByBigcategory" resultType="ProductBean">
		SELECT * FROM product p 
		INNER JOIN category c ON p.smallcategory_name = c.smallcategory_name
		WHERE c.bigcategory_name = #{bigcategory_name} 
		and (p.s_stock>0 or p.M_STOCK>0 or p.L_STOCK>0 or p.XL_STOCK>0)
	</select> 
	
	<update id="updateStock">
		update product 
		set s_stock=s_stock-#{s_stock},m_stock=m_stock-#{m_stock},l_stock=l_stock-#{l_stock},xl_stock=xl_stock-#{xl_stock}
		where product_number=#{product_number}
	</update>
	
	<delete id="deleteProduct">
		delete product where product_number=#{product_number}
	</delete>
	
	<update id="updateProduct">
		update product 
		set product_name=#{product_name}, image=#{image}, price=#{price}, content=#{content}, temperature=#{temperature},
		s_stock=#{s_stock}, m_stock=#{m_stock}, l_stock=#{l_stock}, xl_stock=#{xl_stock}, smallcategory_name=#{smallcategory_name}
		where product_number=#{product_number}
	</update>
	
	<select id="findProductNames" resultType="String">
        SELECT product_name
        FROM product
        WHERE product_name LIKE '%' || #{searchWord} || '%'
        ORDER BY product_name
        FETCH FIRST 5 ROWS ONLY
    </select>
    
    <select id="findProductNames2" resultType="ProductBean">
        SELECT *
        FROM product
        WHERE product_name LIKE '%' || #{searchWord2} || '%'
        ORDER BY product_name
        FETCH FIRST 5 ROWS ONLY
    </select>
    
    <select id="getPop" resultType="ProductBean">
    	SELECT keyword, count
		FROM pop
		ORDER BY count DESC
		FETCH FIRST 10 ROWS ONLY
    </select>
    
    <!-- 키워드 조회 -->
    <select id="getKeywordCount" resultType="java.lang.Integer">
        SELECT count FROM pop WHERE keyword = #{keyword}
    </select>

    <!-- 키워드 추가 -->
    <insert id="insertKeyword">
        INSERT INTO pop (keyword, count) VALUES (#{keyword}, 0)
    </insert>

    <!-- 키워드 업데이트 -->
    <update id="updateKeywordCount">
        UPDATE your_table_name SET count = count + 1 WHERE keyword = #{keyword}
    </update>
</mapper>